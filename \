require 'csv'

# used to import purchases from an tab delim file
module PurchasesFromTabFile
  extend self

  # import each row into some models
  # Tie the data together through the purchase
  def call(file)
    CSV.parse(file, col_sep: "\t", headers: true).map do |row|
      hash = row.to_hash
      purchaser = Purchaser.import hash
      merchant  = Merchant.import  hash
      item      = Item.import      hash

      Purchase.import(hash).map_child_data(purchaser, item, merchant)
    end
  end

end
